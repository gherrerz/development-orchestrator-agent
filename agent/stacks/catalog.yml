# Stack catalog (data-driven)
# Add new stacks here without touching orchestrator/stack_setup code.
# Fields:
#   language: python|javascript|typescript|java|dotnet|go|...
#   toolchain: { kind: python|node|java|dotnet|go, version: "<version>" }
#   deps: { apt:[], pip:[], npm:[] }
#   commands: { test:"...", build:"...", lint:"..." }
#   allowed_test_prefixes: ["..."]  # security allowlist prefixes for test_command

python-fastapi-postgres:
  language: python
  toolchain: { kind: python, version: "3.11" }
  deps:
    pip:
      - fastapi
      - "uvicorn[standard]"
      - httpx
      - psycopg2-binary
      - pytest
  commands:
    test: "pytest -q"
  allowed_test_prefixes:
    - "pytest"
    - "python -m pytest"

python-django:
  language: python
  toolchain: { kind: python, version: "3.11" }
  deps:
    pip:
      - django
      - djangorestframework
      - psycopg2-binary
      - pytest
      - pytest-django
  commands:
    test: "pytest -q"
  allowed_test_prefixes:
    - "pytest"
    - "python -m pytest"

java-spring-boot:
  language: java
  toolchain: { kind: java, version: "21" }
  deps:
    apt:
      - maven
  commands:
    test: "mvn -q test"
    build: "mvn -q -DskipTests package"
  allowed_test_prefixes:
    - "mvn test"
    - "mvn -q test"
    - "./gradlew test"
    - "./gradlew -q test"

node-express:
  language: javascript
  toolchain: { kind: node, version: "20" }
  deps:
    npm:
      - express
  commands:
    test: "npm test"
  allowed_test_prefixes:
    - "npm test"
    - "npm run test"
    - "pnpm test"
    - "pnpm run test"
    - "yarn test"

node-react:
  language: javascript
  toolchain: { kind: node, version: "20" }
  deps:
    npm:
      - react
      - react-dom
  commands:
    test: "npm test"
  allowed_test_prefixes:
    - "npm test"
    - "npm run test"
    - "pnpm test"
    - "pnpm run test"
    - "yarn test"

node-angular:
  language: typescript
  toolchain: { kind: node, version: "20" }
  deps:
    npm:
      - "@angular/core"
      - "@angular/cli"
  commands:
    test: "npm test"
  allowed_test_prefixes:
    - "npm test"
    - "npm run test"
    - "pnpm test"
    - "pnpm run test"
    - "yarn test"

dotnet-webapi:
  language: dotnet
  toolchain: { kind: dotnet, version: "8.0.x" }
  deps: {}
  commands:
    test: "dotnet test"
  allowed_test_prefixes:
    - "dotnet test"

go-fiber:
  language: go
  toolchain: { kind: go, version: "1.22.x" }
  deps: {}
  commands:
    test: "go test ./..."
  allowed_test_prefixes:
    - "go test ./..."
    - "go test ./... -v"
    - "go test ./... -count=1"
